pipeline {
    agent any 

    environment {
        Git_Credentials = credentials("GitHub_Credentials")
        Sonar_Credentials=credentials("Sonar_Token")
    }

    tools {
        maven 'Jenkins_Maven'
    }
    
   

    stages {
        stage("CleanUp_WorkSpace") {
            steps {
                cleanWs()
            }
        }

        stage("Git_Checkout") {
            steps {
                sh 'git clone https://github.com/shaikrizwan40/realtime-project-demo.git'
            }
        }
        
        stage('Test') {
            steps {
                dir ('realtime-project-demo'){
                sh 'mvn test'
                junit '**/target/surefire-reports/*.xml' 
                //This line is used in a Jenkins Pipeline to publish JUnit test results (which are generated by Maven) to the Jenkins UI.
                    }
                    }}


        stage("Build_Project") {
            steps {
                dir('realtime-project-demo') {
                    sh 'mvn clean package'
                }
            }
        }
        
        stage('SonarQube Analysis') {
  
  steps {
      dir('realtime-project-demo'){
    withSonarQubeEnv('Jenkins_SonarQube') {
      sh """
         mvn sonar:sonar \
        -Dsonar.projectKey=realtime-project-demo \
       
      """
    }}
  }
}
    }

    post {
        success {
            echo "✅ Build is successful"
        }
        failure {
            echo "❌ Build failed"
        }
    }
}
